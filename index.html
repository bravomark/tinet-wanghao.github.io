<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Cache" content="no-cache">

  <title>Document</title>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script>
    Date.prototype.Format = function (fmt) {  
        var o = {  
            "M+": this.getMonth() + 1, //月份   
            "d+": this.getDate(), //日   
            "H+": this.getHours(), //小时   
            "m+": this.getMinutes(), //分   
            "s+": this.getSeconds(), //秒   
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度   
            "S": this.getMilliseconds() //毫秒   
        };  
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));  
        for (var k in o)  
        if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));  
        return fmt;  
    }
  </script>
  <script>
    /*
    window.addEventListener('popstate', function(e) {
      $.ajax({url: "https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/popstate", async: false, success:function(result){
          alert('popstate')          
      }})
      let body = { id: '2', email: '333' };
      let headers = { type: 'application/json' };
      let blob = new Blob([JSON.stringify(body)], headers);
      navigator.sendBeacon('https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/popstate', blob);
    })
    */
    /*
    window.addEventListener('pagehide', function(e) {
      $.ajax({url: "https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/pagehide", async: false, success:function(result){
        alert('pagehide')       
      }})
      let body = { id: '2', email: '333' };
      let headers = { type: 'application/json' };
      let blob = new Blob([JSON.stringify(body)], headers);
      navigator.sendBeacon('https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/pagehide', blob);
    })
    */
    /*
    window.addEventListener('unload', function(e) {
      $.ajax({url: "https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/unload", async: false, success:function(result){
        alert('unload')
      }})
      let body = { id: '2', email: '333' };
      let headers = { type: 'application/json' };
      let blob = new Blob([JSON.stringify(body)], headers);
      navigator.sendBeacon('https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/unload', blob);
    })
    */
    /*
    window.onbeforeunload = function(e) {
      $.ajax({url: "https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/onbeforeunload", async: false, success:function(result){
        alert('onbeforeunload')
      }})
    }
    */
    
    
    function demo1_video() {
      try {
        alert('navigator：' + navigator);
        alert('navigator.mediaDevices：' + navigator.mediaDevices);
        alert('navigator.mediaDevices.getUserMedia：' + navigator.mediaDevices.getUserMedia);
        alert('navigator.getUserMedia：' + navigator.getUserMedia);
        alert('navigator.webkitGetUserMedia：' + navigator.webkitGetUserMedia);
        alert('navigator.mozGetUserMedia：' + navigator.mozGetUserMedia);

        if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
          alert('获取audio');
          this.getUserMedia({ video: false, audio: true });
        }
      } catch (e) {
        alert('异常:' + e)
      }
    }

    function demo1_audio() {
      try {
        alert('navigator：' + navigator);
        alert('navigator.mediaDevices：' + navigator.mediaDevices);
        alert('navigator.mediaDevices.getUserMedia：' + navigator.mediaDevices.getUserMedia);
        alert('navigator.getUserMedia：' + navigator.getUserMedia);
        alert('navigator.webkitGetUserMedia：' + navigator.webkitGetUserMedia);
        alert('navigator.mozGetUserMedia：' + navigator.mozGetUserMedia);

        if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
          alert('获取video');
          this.getUserMedia({ video: true, audio: false });
        }
      } catch (e) {
        alert('异常' + e)
      }
    }

    function getUserMedia(constrains) {
      let that = this;
      if (navigator.mediaDevices.getUserMedia) {
        // 最新标准API
        navigator.mediaDevices.getUserMedia(constrains).then(stream => { that.success(stream); }).catch(err => { that.error(err); });
      } else if (navigator.webkitGetUserMedia) {
        // webkit内核浏览器
        navigator.webkitGetUserMedia(constrains).then(stream => { that.success(stream); }).catch(err => { that.error(err); });
      } else if (navigator.mozGetUserMedia) {
        // Firefox浏览器
        navigator.mozGetUserMedia(constrains).then(stream => { that.success(stream); }).catch(err => { that.error(err); });
      } else if (navigator.getUserMedia) {
        // 旧版API
        navigator.getUserMedia(constrains).then(stream => { that.success(stream); }).catch(err => { that.error(err); });
      }
    }
    // 成功的回调函数
    function success(stream) {
      alert("已点击允许,开启成功");
    }
    // 异常的回调函数
    function error(error) {
      alert("访问用户媒体设备失败：", error.name, error.message);
    }
    
    function createA(url) {
      const eleLink = document.createElement("a")
      eleLink.style.display = "none"
      eleLink.href = url
      // 触发点击
      document.body.appendChild(eleLink)
      eleLink.click()
      // 然后移除
      document.body.removeChild(eleLink)
    }
    
    function createA2(url) {
      const eleLink = document.createElement("a")
      eleLink.style.display = "none"
      eleLink.href = url
      eleLink.target = '_blank'
      // 触发点击
      document.body.appendChild(eleLink)
      eleLink.click()
      // 然后移除
      document.body.removeChild(eleLink)
    }
    
    /**
     * 发送通知
     */
    function notice() {
      let msg = '通知：' + new Date().Format("yyyy-MM-dd HH:mm:ss")
      $.ajax({url: "https://api.day.app/gzwpgQyDXNsfdAQRC7dwh/" + msg, success:function(result){

      }})
    }
    
    /**
     * 定时通知
     */
    function timer_notice() {
      setInterval(function() {
        notice()
      }, 10 * 1000)
    }
    timer_notice()
  </script>
</head>
<body>
  版本：2020/08/04 17:50
  <br>
  <button onclick="demo1_video()">Demo1_Video</button>
  <br/>
  <button onclick="demo1_audio()">Demo1_Audio</button>
  <br/>
  <a href="https://codeload.github.com/floadyun/DownloadSpeed/zip/refs/heads/master" target="_blank">测试下载文件</a>
  <br/>
  <button onclick="createA('https://codeload.github.com/floadyun/DownloadSpeed/zip/refs/heads/master')">测试下载文件</button>
  <br/>
  <button onclick="createA2('https://codeload.github.com/floadyun/DownloadSpeed/zip/refs/heads/master')">测试下载文件2</button>
  <br/>
  <button onclick="notice()">测试通知</button>
</body>
</html>
